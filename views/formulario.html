      
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulário - EDUCA MENTE</title>
  <link rel="shortcut icon" href="img/faviconeducamente.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style_formulario.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="container">
    <main class="form-container">
      <h1 class="title">EDUCA MENTE</h1>
      <h2>Formulário de Solicitação</h2>

      <form id="formAgendamentoUnificado" action="/enviar_solicitacao" method="post" enctype="multipart/form-data">

        <!-- Campo Nome: Label e comportamento ajustados via JS -->
        <div class="input-group">
          <label for="name" id="labelName">Nome Completo do Aluno</label>
          <input type="text" id="name" name="name" placeholder="Digite o nome completo"
                 pattern="[A-Za-zÀ-ÖØ-öø-ÿ\s]+" title="Apenas letras e espaços são permitidos." required />
        </div>

        <div class="input-group">
          <label for="age">Data de Nascimento</label>
          <input type="date" id="age" name="age" min="1900-01-01" max="2100-12-31" required />
        </div>

        <div class="input-group">
          <label for="course">Curso</label>
          <select id="course" name="course" required onchange="verificarOutroCurso()">
            <option value="" disabled selected>Selecione o curso</option>
            <option value="Técnico em Administração">Técnico em Administração</option>
            <option value="Técnico em Automação Industrial">Técnico em Automação Industrial</option>
            <option value="Técnico em Desenvolvimento de Sistemas">Técnico em Desenvolvimento de Sistemas</option>
            <option value="Técnico em Eletromecânica">Técnico em Eletromecânica</option>
            <option value="Técnico em Eletrotécnica">Técnico em Eletrotécnica</option>
            <option value="Técnico em Logística">Técnico em Logística</option>
            <option value="Técnico em Mecatrônica">Técnico em Mecatrônica</option>
            <option value="Técnico em Petroquímica">Técnico em Petroquímica</option>
            <option value="Técnico em Química">Técnico em Química</option>
            <option value="Técnico em Refrigeração e Climatização">Técnico em Refrigeração e Climatização</option>
            <option value="Outro">Outro</option>
          </select>
          <input type="text" id="outroCursoInput" name="outro_curso" placeholder="Digite o curso" pattern="[A-Za-zÀ-ÖØ-öø-ÿ\s]+" title="Apenas letras e espaços são permitidos." />
        </div>

        <div class="input-group">
          <label for="shift">Turno</label>
          <select id="shift" name="shift" required>
            <option value="" disabled selected>Selecione o turno</option>
            <option value="matutino">Matutino</option>
            <option value="vespertino">Vespertino</option>
            <option value="noturno">Noturno</option>
          </select>
        </div>

        <div class="input-group">
            <label for="turma">Turma</label>
            <input type="text" id="turma" name="classroom" placeholder="Digite o número da turma"
                   pattern="\d{1,5}" maxlength="5"
                   title="Digite apenas números com até 5 dígitos." required
                   oninput="this.value = this.value.replace(/\D/g, '').slice(0, 5)" />
        </div>
        
        <!-- CAMPO DE EMAIL: Visível e obrigatório apenas para Psicopedagoga -->
        <div class="input-group email conditional-field field-for-psicopedagoga">
          <label for="email">Email do Aluno</label>
          <input type="email" id="email" name="email" placeholder="Digite o email do aluno" />
        </div>

        <div class="input-group">
          <label for="phone">Telefone (Opcional)</label>
          <input type="tel" id="phone" name="phone" placeholder="(00) 90000-0000"
                 pattern="\(\d{2}\) 9?\d{4}-\d{4}"
                 title="Digite o telefone no formato (00) 90000-0000" maxlength="15" />
        </div>

        <div class="input-group">
          <label for="responsible">Responsável (Opcional)</label>
          <input type="text" id="responsible" name="responsible" placeholder="Digite o nome do responsável"
                 pattern="[A-Za-zÀ-ÖØ-öø-ÿ\s]+" title="Apenas letras e espaços são permitidos." />
        </div>

        <div class="input-group">
          <label for="institution">Instituição</label>
          <select id="institution" name="institution" required>
            <option value="" disabled selected>Selecione a instituição</option>
            <option value="SENAI Lauro de Freitas">SENAI Lauro de Freitas</option>
            <option value="SENAI Camaçari">SENAI Camaçari</option>
            <option value="SENAI CIMATEC">SENAI CIMATEC</option>
            <option value="SENAI Dendezeiros">SENAI Dendezeiros</option>
            <option value="SENAI Candeias">SENAI Candeias</option>
          </select>
        </div>

        <div class="input-group">
          <label for="motivo">Motivos / Observações do Solicitante</label>
          <select id="motivo" name="observations" required onchange="verificarOutroMotivo()">
            <option value="" disabled selected>Selecione o motivo</option>
            <option value="Dificuldades na leitura e escrita">Dificuldades na leitura e escrita</option>
            <option value="Problemas com matemática">Problemas com matemática</option>
            <option value="Déficit de atenção e concentração">Déficit de atenção e concentração</option>
            <option value="Diagnóstico ou suspeita de TDAH, dislexia, discalculia, etc.">Diagnóstico ou suspeita de TDAH, dislexia, discalculia, etc.</option>
            <option value="Atraso no desenvolvimento acadêmico">Atraso no desenvolvimento acadêmico</option>
            <option value="Dificuldades na linguagem oral ou escrita">Dificuldades na linguagem oral ou escrita</option>
            <option value="Dificuldade de memorização e organização do pensamento">Dificuldade de memorização e organização do pensamento</option>
            <option value="Desmotivação ou rejeição ao curso">Desmotivação ou rejeição ao curso</option>
            <option value="Problemas emocionais que afetam o aprendizado">Problemas emocionais que afetam o aprendizado</option>
            <option value="Acompanhamento individualizado para melhorar o desempenho acadêmico">Acompanhamento individualizado para melhorar o desempenho acadêmico</option>
            <option value="Outro">Outro</option>
          </select>
          <input type="text" id="outroMotivoInput" name="outro_motivo" placeholder="Descreva o motivo ou observações importantes" />
        </div>

        <!-- CAMPO ANEXAR LAUDO: Visível para Aluno e Psicopedagoga -->
        <div class="input-group laudo conditional-field field-for-aluno field-for-psicopedagoga">
          <label for="file">Anexar Laudo (Foto ou PDF) (Opcional)</label>
          <input type="file" id="file" name="file" accept="image/*,application/pdf" />
        </div>

        <div class="form-actions">
          <p class="forgot-password"><a href="#" class="btn-primary" onclick="voltar()">Voltar para o início</a></p>
          <button type="submit" class="btn-primary">Enviar Solicitação</button> <!-- Removido onclick="voltar()" daqui -->
        </div>
      </form>
    </main>
  </div>

  <script>
    // FUNÇÕES AUXILIARES (obtidas dos seus scripts originais)
    function getTipoUsuario() {
      // Tenta obter de uma variável global injetada pelo Node.js (preferencial)
      if (typeof TIPO_USUARIO_LOGADO !== 'undefined' && TIPO_USUARIO_LOGADO) {
        return TIPO_USUARIO_LOGADO;
      }
      // Fallback para cookie (como você tinha)
      const match = document.cookie.match(/tipoUsuario=([^;]+)/);
      return match ? decodeURIComponent(match[1]) : null; // ou 'desconhecido'
    }

    function getNomeUsuarioLogado() {
      // Tenta obter de uma variável global injetada pelo Node.js (preferencial)
      if (typeof NOME_USUARIO_LOGADO !== 'undefined' && NOME_USUARIO_LOGADO) {
        return NOME_USUARIO_LOGADO;
      }
      // Fallback para cookie (exemplo)
      const match = document.cookie.match(/nomeUsuario=([^;]+)/); // Supondo que você tenha um cookie 'nomeUsuario'
      return match ? decodeURIComponent(match[1]) : "";
    }

    function verificarOutroCurso() {
      const cursoSelect = document.getElementById('course');
      const curso = cursoSelect.value;
      const outroInput = document.getElementById('outroCursoInput');
      if (curso === 'Outro') {
        outroInput.style.display = 'block';
        outroInput.required = true;
      } else {
        outroInput.style.display = 'none';
        outroInput.required = false;
        outroInput.value = '';
      }
    }

    function verificarOutroMotivo() {
      const motivoSelect = document.getElementById('motivo');
      const motivo = motivoSelect.value;
      const outroMotivoInput = document.getElementById('outroMotivoInput');
      if (motivo === 'Outro') {
        outroMotivoInput.style.display = 'block';
        outroMotivoInput.required = true;
      } else {
        outroMotivoInput.style.display = 'none';
        outroMotivoInput.required = false;
        outroMotivoInput.value = '';
      }
    }

    function voltar() {
      const tipo = getTipoUsuario();
      if (tipo === 'psicopedagoga') {
        window.location.href = "/painel"; // Ou a rota principal da psicopedagoga
      } else { // Aluno ou Professor
        window.location.href = "/"; // Ou a rota principal de alunos/professores
      }
    }

    // LÓGICA PRINCIPAL DE ADAPTAÇÃO DO FORMULÁRIO
    document.addEventListener('DOMContentLoaded', () => {
      const tipoUsuario = getTipoUsuario();

      const labelName = document.getElementById('labelName');
      const inputName = document.getElementById('name');
      const inputEmail = document.getElementById('email');
      
      // Elementos condicionais
      const emailField = document.querySelector('.field-for-psicopedagoga'); // A div que envolve o email
      const laudoFields = document.querySelectorAll('.field-for-aluno.field-for-psicopedagoga'); // As divs do laudo

      // Configurações para o campo Nome
      if (tipoUsuario === 'aluno') {
        labelName.textContent = 'Seu Nome Completo';
        const nomeAlunoLogado = getNomeUsuarioLogado();
        if (nomeAlunoLogado) {
          inputName.value = nomeAlunoLogado;
          inputName.disabled = true; // Opcional: desabilitar se pré-preenchido
        }
      } else { // Professor ou Psicopedagoga
        labelName.textContent = 'Nome Completo do Aluno';
        inputName.disabled = false; // Garantir que está habilitado
      }

      // Configurações para campos específicos do tipo de usuário
      if (tipoUsuario === 'psicopedagoga') {
        if (emailField) {
            emailField.style.display = 'block';
            if(inputEmail) inputEmail.required = true;
        }
        laudoFields.forEach(field => field.style.display = 'block');
      } else if (tipoUsuario === 'aluno') {
        laudoFields.forEach(field => field.style.display = 'block');
        // Aluno não tem campo de email visível
        if (emailField) emailField.style.display = 'none';
        if(inputEmail) inputEmail.required = false;

      } else if (tipoUsuario === 'professor') {
        // Professor não tem campo de email nem de laudo
        if (emailField) emailField.style.display = 'none';
        if(inputEmail) inputEmail.required = false;
        laudoFields.forEach(field => field.style.display = 'none');
      } else {
        // Tipo de usuário desconhecido ou não logado, talvez redirecionar ou mostrar mensagem de erro
        console.warn("Tipo de usuário não identificado. O formulário pode não funcionar corretamente.");
        // Por segurança, esconder todos os campos condicionais se o tipo não for reconhecido
        document.querySelectorAll('.conditional-field').forEach(field => field.style.display = 'none');
      }

      // Chamadas iniciais para os selects com "Outro"
      verificarOutroCurso();
      verificarOutroMotivo();

      // ADICIONAR VALIDAÇÕES DE INPUT (como nos seus scripts originais)
      const nameInputEvent = document.getElementById('name');
      if (nameInputEvent) {
        nameInputEvent.addEventListener('input', function () {
          this.value = this.value.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ\s]/g, '');
        });
      }

      const responsibleInput = document.getElementById('responsible');
      if (responsibleInput) {
        responsibleInput.addEventListener('input', function () {
          this.value = this.value.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ\s]/g, '');
        });
      }
      
      const outroCursoInput = document.getElementById('outroCursoInput');
      if (outroCursoInput) {
        outroCursoInput.addEventListener('input', function () {
          this.value = this.value.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ\s]/g, '');
        });
      }

      const phoneInput = document.getElementById('phone');
      if (phoneInput) {
        phoneInput.addEventListener('input', function (e) {
          let value = e.target.value.replace(/\D/g, '');
          value = value.slice(0, 11);
          if (value.length > 10) {
            value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
          } else if (value.length > 6) {
            value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
          } else if (value.length > 2) {
            value = value.replace(/^(\d{2})(\d*).*/, '($1) $2');
          } else if (value.length > 0) {
            value = value.replace(/^(\d*).*/, '($1');
          }
          e.target.value = value;
        });
      }
    });
  </script>
</body>
</html>